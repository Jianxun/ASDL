schema_version: 2

current_sprint:
  - id: T-139
    title: Module-local named pattern macro expansion
    owner: Executor
    dod: >
      Implement module-local named pattern substitution for `<@name>` as an AST
      elaboration step before AST->GraphIR lowering. Replace `<@name>` tokens in
      instance names, net names, endpoint expressions, instance params, and
      instance_defaults bindings with the referenced single-group pattern token.
      Enforce pattern name regex, forbid recursion, and emit diagnostics for
      undefined or invalid named patterns. Preserve source spans for diagnostics
      and add unit tests covering successful substitution and error cases.
    verify:
      - venv/bin/pytest tests/unit_tests/parser -v
      - venv/bin/pytest tests/unit_tests/ir -v
    files:
      - src/asdl/ast/models.py
      - src/asdl/ast/parser.py
      - src/asdl/ir/converters/ast_to_graphir.py
      - src/asdl/ir/converters/ast_to_graphir_lowering.py
      - tests/unit_tests/parser/test_pattern_expansion.py
    links:
      scratchpad: agents/scratchpads/T-139_named_pattern_macro_expansion.md
backlog: []

exploration_candidates:
  - IFIR diagnostics spans: mapping strategy, edge cases, and test fixtures.
  - CLI pipeline UX: command flow, error messaging, and file layout.
  - Netlist emission validation: strictness vs warnings; validation stages.
  - xDSL pipeline boundaries: pass split/merge opportunities and IR boundaries.
  - Codebase map gaps: navigation audit for future Executors.
