schema_version: 2

current_sprint:
  - id: T-185
    title: Align core port order with instance_defaults rules
    owner: Executor
    dod: >
      Extend PatternedGraph lowering to include `$` nets introduced by
      `instance_defaults` in `module_graph.port_order`, appended after explicit
      `$` nets from `nets`. Add coverage for port order when defaults introduce
      new `$` nets.
    verify:
      - venv/bin/pytest tests/unit_tests/core/test_patterned_graph_lowering.py -v
    files:
      - src/asdl/core/build_patterned_graph.py
      - tests/unit_tests/core/test_patterned_graph_lowering.py
    links:
      spec: docs/specs/spec_ast.md
      scratchpad: agents/scratchpads/T-185_port_order_defaults.md
  - id: T-186
    title: Align refactor diagnostics with existing IR codes
    owner: Executor
    dod: >
      Update PatternedGraph lowering diagnostics to use existing IR codes
      (IR-001/IR-002/IR-003 where applicable) per `docs/specs/spec_diagnostic_codes.md`.
      Add tests asserting the emitted codes for invalid instance/endpoint and
      pattern parse failures.
    verify:
      - venv/bin/pytest tests/unit_tests/core/test_patterned_graph_lowering.py -v
    files:
      - src/asdl/core/build_patterned_graph.py
      - tests/unit_tests/core/test_patterned_graph_lowering.py
      - docs/specs/spec_diagnostic_codes.md
    links:
      spec: docs/specs/spec_diagnostic_codes.md
      scratchpad: agents/scratchpads/T-186_refactor_diag_codes.md
  - id: T-187
    title: Resolve multi-file references in PatternedGraph lowering
    owner: Executor
    dod: >
      Add ProgramDB-backed reference resolution for modules/devices during
      PatternedGraph lowering so cross-file instance refs are resolved. Include
      tests for multi-file resolution via import roots.
    verify:
      - venv/bin/pytest tests/unit_tests/core/test_patterned_graph_lowering.py -v
    files:
      - src/asdl/core/build_patterned_graph.py
      - src/asdl/imports/resolve.py
      - tests/unit_tests/core/test_patterned_graph_lowering.py
      - tests/unit_tests/imports/test_import_pipeline.py
    links:
      spec: docs/specs_refactor/spec_refactor_stack.md
      scratchpad: agents/scratchpads/T-187_patterned_graph_programdb.md
  - id: T-188
    title: Enforce splice rules for refactor bindings
    owner: Executor
    dod: >
      Treat spliced net names as errors in PatternedGraph lowering and add
      binding tests that allow spliced endpoints only for index or scalar
      bindings while rejecting spliced broadcast. Ensure diagnostics align with
      the refactor spec updates.
    verify:
      - venv/bin/pytest tests/unit_tests/core/test_patterned_graph_lowering.py tests/unit_tests/patterns_refactor/test_binding.py -v
    files:
      - src/asdl/core/build_patterned_graph.py
      - src/asdl/patterns_refactor/bind.py
      - tests/unit_tests/core/test_patterned_graph_lowering.py
      - tests/unit_tests/patterns_refactor/test_binding.py
    links:
      spec: docs/specs_refactor/spec_refactor_pattern_service.md
      adr: agents/adr/ADR-0022-no-net-splices.md
      scratchpad: agents/scratchpads/T-188_splice_binding_rules.md
backlog: []
