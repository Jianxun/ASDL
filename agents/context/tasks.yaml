schema_version: 2

current_sprint:
  - id: T-113
    title: GraphIR program/module/device ops
    owner: Executor
    dod: >
      Create the GraphIR dialect package with program/module/device ops, stable
      ID attrs, and module port_order. Register the dialect, add minimal verify
      checks for program/module/device structure, and add focused tests for the
      new ops.
    verify:
      - venv/bin/pytest tests/unit_tests/ir/test_graphir_program.py -v
    files:
      - src/asdl/ir/graphir/__init__.py
      - src/asdl/ir/graphir/dialect.py
      - src/asdl/ir/__init__.py
      - tests/unit_tests/ir/test_graphir_program.py
    links:
      scratchpad: agents/scratchpads/T-113_graphir_program_ops.md
      spec: docs/specs/spec_asdl_graphir.md
  - id: T-114
    title: GraphIR net/instance/endpoint ops
    owner: Executor
    depends_on:
      - T-113
    dod: >
      Add GraphIR net/instance/endpoint ops with stable IDs and implement module
      verification for net/instance name uniqueness and endpoint ownership plus
      endpoint uniqueness per (inst_id, port_path). Add tests covering valid and
      invalid module graphs.
    verify:
      - venv/bin/pytest tests/unit_tests/ir/test_graphir_structure.py -v
    files:
      - src/asdl/ir/graphir/dialect.py
      - tests/unit_tests/ir/test_graphir_structure.py
    links:
      scratchpad: agents/scratchpads/T-114_graphir_structure_ops.md
      spec: docs/specs/spec_asdl_graphir.md
  - id: T-115
    title: GraphIR bundles and pattern_expr ops
    owner: Executor
    depends_on:
      - T-113
    dod: >
      Define GraphIR bundle and pattern_expr ops, including ParamRef ownership
      for param patterns. Implement verification for bundle ownership and
      pattern_expr kind/owner alignment and add unit tests for net/endpoint/param
      pattern ownership.
    verify:
      - venv/bin/pytest tests/unit_tests/ir/test_graphir_patterns.py -v
    files:
      - src/asdl/ir/graphir/dialect.py
      - tests/unit_tests/ir/test_graphir_patterns.py
    links:
      scratchpad: agents/scratchpads/T-115_graphir_pattern_ops.md
      spec: docs/specs/spec_asdl_graphir.md
  - id: T-116
    title: AST to GraphIR converter
    owner: Executor
    depends_on:
      - T-113
      - T-114
    dod: >
      Implement an AST -> GraphIR converter for a single document with resolved
      local symbols. Convert modules, devices, nets, instances, and endpoints
      into GraphIR ops with stable IDs and port_order, and emit diagnostics for
      unresolved references. Add unit tests for a single-file fixture.
    verify:
      - venv/bin/pytest tests/unit_tests/ir/test_graphir_converter.py -v
    files:
      - src/asdl/ir/converters/ast_to_graphir.py
      - tests/unit_tests/ir/test_graphir_converter.py
      - tests/unit_tests/ir/fixtures/graphir_single_file.asdl
    links:
      scratchpad: agents/scratchpads/T-116_ast_to_graphir_converter.md
      spec: docs/specs/spec_asdl_graphir.md
  - id: T-117
    title: Import graph to GraphIR design
    owner: Executor
    depends_on:
      - T-116
    dod: >
      Build a GraphIR design from the import graph by converting each document
      with its NameEnv/ProgramDB, preserving entry-file order and file_id
      metadata. Add tests that cover multi-file resolution and unresolved import
      diagnostics.
    verify:
      - venv/bin/pytest tests/unit_tests/ir/test_graphir_imports.py -v
    files:
      - src/asdl/ir/converters/ast_to_graphir.py
      - src/asdl/ir/pipeline.py
      - tests/unit_tests/ir/test_graphir_imports.py
    links:
      scratchpad: agents/scratchpads/T-117_graphir_import_graph.md
      spec: docs/specs/spec_asdl_graphir.md
  - id: T-118
    title: Pipeline switch to GraphIR
    owner: Executor
    depends_on:
      - T-110
      - T-117
    dod: >
      Switch the MVP pipeline to AST/imports -> GraphIR -> IFIR -> emit. Add a
      GraphIR verification pass, wire the new converter into CLI/pipeline entry
      points, and update the end-to-end pipeline test fixture.
    verify:
      - venv/bin/pytest tests/unit_tests/e2e/test_pipeline_mvp.py -v
    files:
      - src/asdl/ir/pipeline.py
      - src/asdl/cli/__init__.py
      - tests/unit_tests/e2e/test_pipeline_mvp.py
    links:
      scratchpad: agents/scratchpads/T-118_pipeline_graphir_switch.md
      spec: docs/specs/spec_asdl_graphir.md
  - id: T-110
    title: GraphIR to IFIR projection
    owner: Executor
    depends_on:
      - T-114
    dod: >
      Implement GraphIR -> IFIR lowering as a thin projection and switch the
      netlist emitter to consume IFIR derived from GraphIR. Update IFIR and
      netlist tests to validate consistent output.
    verify:
      - venv/bin/pytest tests/unit_tests/netlist/test_netlist_emitter.py -v
    files:
      - src/asdl/ir/converters/graphir_to_ifir.py
      - src/asdl/ir/ifir/
      - src/asdl/emit/netlist/api.py
      - tests/unit_tests/ir/test_ifir_converter.py
      - tests/unit_tests/netlist/test_netlist_emitter.py
    links:
      scratchpad: agents/scratchpads/T-110_graphir_to_ifir_projection.md
      spec: docs/specs/spec_asdl_graphir.md
  - id: T-111
    title: GraphIR pattern bundles
    owner: Executor
    depends_on:
      - T-115
      - T-116
    dod: >
      Wire pattern expansion metadata into GraphIR bundles/pattern_expr ops,
      implement rebundling rules, and ensure projections honor bundle ordering
      without pattern inference. Add targeted pattern unit tests.
    verify:
      - venv/bin/pytest tests/unit_tests/ir/test_pattern_atomization.py -v
    files:
      - src/asdl/ir/graphir/
      - src/asdl/ir/pattern_atomization.py
      - src/asdl/ir/pattern_elaboration.py
      - tests/unit_tests/ir/test_pattern_atomization.py
    links:
      scratchpad: agents/scratchpads/T-111_graphir_pattern_bundles.md
      spec: docs/specs/spec_asdl_graphir.md
  - id: T-112
    title: GraphIR to AST normalized output
    owner: Executor
    depends_on:
      - T-116
    dod: >
      Add a GraphIR -> AST normalized serializer that emits explicit nets and
      instances without authoring sugar. Include roundtrip tests that parse,
      lower to GraphIR, and re-emit AST with deterministic ordering.
    verify:
      - venv/bin/pytest tests/unit_tests/ast -v
    files:
      - src/asdl/ir/converters/graphir_to_ast.py
      - src/asdl/ast/models.py
      - src/asdl/ast/parser.py
      - tests/unit_tests/ast/test_graphir_roundtrip.py
    links:
      scratchpad: agents/scratchpads/T-112_graphir_to_ast_normalized.md
      spec: docs/specs/spec_asdl_graphir.md
  - id: T-119
    title: Named pattern substitution in GraphIR path
    owner: Architect
    dod: >
      Decide where named pattern substitution belongs in the GraphIR pipeline
      (AST parse, AST->GraphIR conversion, or a dedicated pass), record the
      decision in contract/ADR if needed, and note migration implications.
    verify:
      - rg -n "Named pattern substitution" agents/context/contract.md agents/adr
    files:
      - agents/context/contract.md
      - agents/adr/ADR-0015-named-pattern-substitution.md
      - agents/scratchpads/T-119_named_pattern_substitution.md
    links:
      scratchpad: agents/scratchpads/T-119_named_pattern_substitution.md
backlog: []

exploration_candidates:
  - IFIR diagnostics spans: mapping strategy, edge cases, and test fixtures.
  - CLI pipeline UX: command flow, error messaging, and file layout.
  - Netlist emission validation: strictness vs warnings; validation stages.
  - xDSL pipeline boundaries: pass split/merge opportunities and IR boundaries.
  - Codebase map gaps: navigation audit for future Executors.
