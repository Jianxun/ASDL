schema_version: 2

current_sprint:
  - id: T-170
    title: Update pattern specs for tagged axes and broadcast matching
    owner: Architect
    dod: >
      Update the AST and pattern expansion specs to allow pattern definitions
      as strings or objects ({expr, tag}), define axis_id resolution and
      module-local tag scope, and document the tagged-axis broadcast matching
      rules with explicit failure cases and examples.
    verify:
      - rg -n "tag" docs/specs/spec_ast.md docs/specs/spec_asdl_pattern_expansion.md
    files:
      - docs/specs/spec_ast.md
      - docs/specs/spec_asdl_pattern_expansion.md
    links:
      scratchpad: agents/scratchpads/T-170_pattern_tags_specs.md
  - id: T-171
    title: Add tagged pattern definitions to AST models and parser
    owner: Executor
    dod: >
      Extend AST models and parsing to accept patterns as strings or objects
      with {expr, tag}, validate allowed keys and literal tag names, and expose
      axis_id + source spans for named pattern groups for downstream diagnostics.
      Keep named pattern macro expansion behavior intact (expr substitution only).
      Add unit tests covering string vs object patterns, invalid keys/types,
      and axis_id derivation.
    verify:
      - venv/bin/pytest tests/unit_tests/ast -v
    files:
      - src/asdl/ast/models.py
      - src/asdl/ast/parser.py
      - src/asdl/ast/named_patterns.py
      - src/asdl/ast/location.py
      - tests/unit_tests/ast/test_models.py
    links:
      scratchpad: agents/scratchpads/T-171_tagged_pattern_ast.md
  - id: T-172
    title: Implement tagged-axis broadcast binding in GraphIR lowering
    owner: Executor
    depends_on:
      - T-171
    dod: >
      Update GraphIR net lowering to use axis_id metadata from named patterns,
      enforce tagged-axis broadcast matching (subsequence order, length checks,
      no duplicate axis_id per expression), and emit explicit diagnostics that
      reference the offending pattern token spans. Add unit tests covering the
      bus broadcast case with tagged axes and explicit failure modes.
    verify:
      - venv/bin/pytest tests/unit_tests/ir/test_graphir_converter.py -v
    files:
      - src/asdl/ir/converters/ast_to_graphir_lowering_nets.py
      - tests/unit_tests/ir/test_graphir_converter.py
    links:
      scratchpad: agents/scratchpads/T-172_tagged_axis_broadcast.md
  - id: T-173
    title: Extract tagged-axis analysis helpers for GraphIR net lowering
    owner: Executor
    dod: >
      Move tagged-axis analysis helpers from
      ast_to_graphir_lowering_nets.py into a dedicated module, update
      imports/callers, and keep diagnostics behavior identical. Public helpers
      must keep or add docstrings.
    verify:
      - venv/bin/pytest tests/unit_tests/ir/test_graphir_converter.py -v
    files:
      - src/asdl/ir/converters/ast_to_graphir_axis.py
      - src/asdl/ir/converters/ast_to_graphir_lowering_nets.py
      - tests/unit_tests/ir/test_graphir_converter.py
    links:
      scratchpad: agents/scratchpads/T-173_axis_helpers_refactor.md
  - id: T-174
    title: Refactor explicit net lowering to reduce nested branching
    owner: Executor
    depends_on:
      - T-173
    dod: >
      Introduce small helpers for net-pattern preparation and endpoint mapping
      in the explicit-net path, and flatten the control flow without changing
      diagnostics or outputs.
    verify:
      - venv/bin/pytest tests/unit_tests/ir/test_graphir_converter.py -v
    files:
      - src/asdl/ir/converters/ast_to_graphir_lowering_nets.py
    links:
      scratchpad: agents/scratchpads/T-174_explicit_net_refactor.md
  - id: T-175
    title: Refactor instance-default net lowering to share helpers
    owner: Executor
    depends_on:
      - T-174
    dod: >
      Apply the shared net-prep and endpoint-mapping helpers to the
      instance-defaults path and reduce duplicated if/else blocks while keeping
      diagnostics identical.
    verify:
      - venv/bin/pytest tests/unit_tests/ir/test_graphir_converter.py -v
    files:
      - src/asdl/ir/converters/ast_to_graphir_lowering_nets.py
    links:
      scratchpad: agents/scratchpads/T-175_defaults_refactor.md
backlog: []
