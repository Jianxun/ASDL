schema_version: 2

current_sprint:
  - id: T-078
    title: Propagate per-entry source spans into NFIR/IFIR
    owner: Executor
    dod: >
      Capture YAML locations for `nets` and `instances` map entries during parsing
      and store them as ModuleDecl private metadata. Use these locations to set
      `src` on NFIR NetOp/InstanceOp and carry them through NFIR->IFIR so
      downstream diagnostics resolve to file/line/col. Update IR diagnostics
      tests so errors tied to net/instance data include non-null spans.
    verify:
      - pytest tests/unit_tests/ir -v
    files:
      - src/asdl/ast/models.py
      - src/asdl/ast/parser.py
      - src/asdl/ir/converters/ast_to_nfir.py
      - src/asdl/ir/converters/nfir_to_ifir.py
      - tests/unit_tests/ir/test_converter.py
    links:
      scratchpad: agents/scratchpads/T-078_diagnostics_spans_ir.md
  - id: T-079
    title: End-to-end diagnostics span coverage
    owner: Executor
    dod: >
      Add e2e diagnostics tests that run parse/lower/emit flows with known
      failures and assert each emitted diagnostic has a populated
      `primary_span` (no `NO_SPAN_NOTE`). Cover at least one error from the
      parser, IR lowering, and netlist verification/emission stages.
    verify:
      - pytest tests/unit_tests/e2e -v
    files:
      - tests/unit_tests/e2e/test_pipeline_mvp.py
      - tests/unit_tests/netlist/test_netlist_emitter.py
    links:
      scratchpad: agents/scratchpads/T-079_diagnostics_spans_e2e.md
  - id: T-080
    title: Netlist header timestamp placeholders
    owner: Executor
    dod: >
      Add `emit_date` and `emit_time` placeholders for `__netlist_header__` and
      `__netlist_footer__` system devices. Capture a single emit timestamp per
      netlist (plumbed via `EmitOptions`/`emit_netlist`) and format it into the
      new placeholders. Template validation must accept the new placeholders.
      Update the MVP netlist emission spec to document the placeholders and
      that emission depends entirely on backend templates. Netlist tests must
      cover substitution with a deterministic timestamp.
    verify:
      - pytest tests/unit_tests/netlist -v
    files:
      - src/asdl/emit/netlist/api.py
      - src/asdl/emit/netlist/render.py
      - src/asdl/emit/netlist/templates.py
      - tests/unit_tests/netlist/test_netlist_emitter.py
      - docs/specs_mvp/spec_netlist_emission_mvp.md
    links:
      scratchpad: agents/scratchpads/T-080_netlist_header_time.md
  - id: T-081
    title: Import path env var expansion
    owner: Executor
    dod: >
      Ensure import path resolution expands `~` and `$VAR`/`${VAR}` in `imports`
      path values and in `ASDL_LIB_PATH` entries. Add tests that cover env var
      expansion for direct import paths and logical-path resolution via
      `ASDL_LIB_PATH` (including `~`). If expansion fails or yields empty paths,
      emit `AST-011` malformed import diagnostics.
    verify:
      - pytest tests/unit_tests/parser/test_import_resolution.py -v
    files:
      - src/asdl/imports/resolver.py
      - tests/unit_tests/parser/test_import_resolution.py
      - docs/specs/spec_asdl_import.md
    links:
      scratchpad: agents/scratchpads/T-081_import_env_expansion.md
backlog:
  - id: T-084
    title: AST schema for instance_defaults + patterns
    owner: Executor
    dod: >
      Add module-level `patterns` and `instance_defaults` to the AST schema and
      parser. Enforce shape validation for pattern entries and default binding
      maps. Add parser/AST tests for valid and invalid shapes (including
      module-local-only behavior and required `bindings` map).
    verify:
      - pytest tests/unit_tests/ast -v
      - pytest tests/unit_tests/parser -v
    files:
      - src/asdl/ast/models.py
      - src/asdl/ast/parser.py
      - tests/unit_tests/ast/test_models.py
      - tests/unit_tests/parser/test_parser.py
    links:
      adr: agents/adr/ADR-0007-instance-defaults.md
  - id: T-085
    title: Apply instance_defaults in AST->NFIR conversion
    owner: Executor
    dod: >
      Apply `instance_defaults` during AST->NFIR conversion to create/augment
      nets. Emit warnings on default overrides unless the endpoint token uses
      `!inst.pin`, and suppress warnings when the explicit binding matches the
      default. Ensure `$` nets introduced by defaults append to `port_order`
      after explicit `$` nets in `nets`. Add IR tests for overrides and port
      ordering.
    verify:
      - pytest tests/unit_tests/ir/test_converter.py -v
    files:
      - src/asdl/ir/converters/ast_to_nfir.py
      - tests/unit_tests/ir/test_converter.py
    links:
      adr: agents/adr/ADR-0007-instance-defaults.md
  - id: T-086
    title: Named pattern macro expansion (<@name>)
    owner: Executor
    dod: >
      Implement module-local named pattern substitution for `<@name>` prior to
      AST->NFIR conversion (no recursion). Reject undefined names and invalid
      pattern definitions (non-group tokens). Add IR tests for substitution and
      diagnostics.
    verify:
      - pytest tests/unit_tests/ir/test_converter.py -v
    files:
      - src/asdl/ir/converters/ast_to_nfir.py
      - tests/unit_tests/ir/test_converter.py
    links:
      adr: agents/adr/ADR-0008-named-patterns.md
  - id: T-087
    title: Remove implicit joiner in pattern expansion
    owner: Executor
    dod: >
      Update core pattern expansion to perform literal concatenation (no
      implicit `_` insertion). Refresh pattern expansion unit tests to match the
      new semantics and update any affected examples/fixtures.
    verify:
      - pytest tests/unit_tests/parser/test_pattern_expansion.py -v
    files:
      - src/asdl/patterns.py
      - tests/unit_tests/parser/test_pattern_expansion.py
    links:
      adr: agents/adr/ADR-0009-pattern-joiner-explicit.md
  - id: T-088
    title: Pattern joiner fallout fixes in IR/elaboration tests
    owner: Executor
    dod: >
      Update IR elaboration and netlist emission tests/fixtures to align with
      literal-concatenation pattern expansion (no implicit `_`). Ensure pattern
      expansion tests pass end-to-end.
    verify:
      - pytest tests/unit_tests/ir -v
      - pytest tests/unit_tests/netlist -v
    files:
      - tests/unit_tests/ir/test_pattern_elaboration.py
      - tests/unit_tests/netlist/test_netlist_emitter.py
    links:
      adr: agents/adr/ADR-0009-pattern-joiner-explicit.md
  - id: T-089
    title: Patterned instance parameter expansion
    owner: Executor
    dod: >
      Expand pattern tokens in instance parameter values after instance-name
      expansion. Support scalar broadcast and length-N zip; reject mismatched
      lengths. Add tests that cover broadcast, zip, and error cases.
    verify:
      - pytest tests/unit_tests/ir/test_pattern_elaboration.py -v
      - pytest tests/unit_tests/netlist/test_netlist_emitter.py -v
    files:
      - src/asdl/ir/pattern_elaboration.py
      - tests/unit_tests/ir/test_pattern_elaboration.py
    links:
      adr: agents/adr/ADR-0010-patterned-params.md

exploration_candidates:
  - IFIR diagnostics spans: mapping strategy, edge cases, and test fixtures.
  - CLI pipeline UX: command flow, error messaging, and file layout.
  - Netlist emission validation: strictness vs warnings; validation stages.
  - xDSL pipeline boundaries: pass split/merge opportunities and IR boundaries.
  - Codebase map gaps: navigation audit for future Executors.
