schema_version: 2

current_sprint:
  - id: T-180
    title: Define PatternedGraph core dataclasses + registries
    owner: Executor
    dod: >
      Implement dataclass-based ProgramGraph/ModuleGraph/NetBundle/InstanceBundle/
      EndpointBundle plus registry types (PatternExpressionRegistry, SourceSpanIndex,
      SchematicHints). Add tests covering construction, endpoint ownership, and
      registry optionality.
    verify:
      - venv/bin/pytest tests/unit_tests/core/test_patterned_graph.py -v
    files:
      - src/asdl/core/graph.py
      - src/asdl/core/registries.py
      - src/asdl/core/__init__.py
      - tests/unit_tests/core/test_patterned_graph.py
    links:
      spec: docs/specs_refactor/spec_refactor_patterned_graph.md
      scratchpad: agents/scratchpads/T-180_patterned_graph_core.md
  - id: T-181
    title: Implement refactor pattern service (parse/bind/expand)
    owner: Executor
    depends_on:
      - T-180
    dod: >
      Build pure pattern service modules for parsing PatternExpr, named pattern
      substitution, expansion, and binding (named-axis broadcast). Add tests for
      splice flattening, endpoint expansion, and axis broadcast mismatches.
    verify:
      - venv/bin/pytest tests/unit_tests/patterns_refactor -v
    files:
      - src/asdl/patterns_refactor/parser.py
      - src/asdl/patterns_refactor/expand.py
      - src/asdl/patterns_refactor/bind.py
      - src/asdl/patterns_refactor/__init__.py
      - tests/unit_tests/patterns_refactor/test_binding.py
    links:
      spec: docs/specs_refactor/spec_refactor_pattern_service.md
      scratchpad: agents/scratchpads/T-181_pattern_service.md
  - id: T-182
    title: Add PatternedGraph query/index helpers
    owner: Executor
    depends_on:
      - T-180
    dod: >
      Implement GraphIndex and DesignQuery helpers (net/instance lookup and
      adjacency lists) derived from PatternedGraph. Add tests for deterministic
      lookup and adjacency construction.
    verify:
      - venv/bin/pytest tests/unit_tests/core/test_query.py -v
    files:
      - src/asdl/core/index.py
      - src/asdl/core/query.py
      - src/asdl/core/__init__.py
      - tests/unit_tests/core/test_query.py
    links:
      spec: docs/specs_refactor/spec_refactor_patterned_graph.md
      scratchpad: agents/scratchpads/T-182_patterned_graph_query.md
  - id: T-183
    title: Align PatternedGraph registries and metadata contracts
    owner: Architect
    depends_on:
      - T-180
    dod: >
      Add missing provenance registries (PatternOriginIndex, ParamPatternOriginIndex)
      to the core registry set, expand PatternExpr protocol to capture parsed
      structure used by the pattern service, and resolve annotation storage
      (registry vs bundle fields) with tests covering the chosen contract.
    verify:
      - venv/bin/pytest tests/unit_tests/core/test_patterned_graph.py -v
    files:
      - src/asdl/core/registries.py
      - src/asdl/core/graph.py
      - src/asdl/core/__init__.py
      - tests/unit_tests/core/test_patterned_graph.py
      - docs/specs_refactor/spec_refactor_patterned_graph.md
    links:
      spec: docs/specs_refactor/spec_refactor_patterned_graph.md
      scratchpad: agents/scratchpads/T-183_patterned_graph_registry_alignment.md
backlog: []
