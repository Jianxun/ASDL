schema_version: 2

current_sprint:
  - id: T-149
    title: Diagnostics e2e conventions and manifest
    owner: Executor
    dod: >
      Create `tests/e2e/diagnostics/README.md` documenting the directory
      layout, naming (`<CODE>_<slug>`), required files per case (`case.asdl`,
      `README.md`, `expected.txt`), and command conventions (default to
      `asdlc netlist`, use `ir-dump`/`schema` when required). Document the
      pytest harness expectations (manifest-driven, `expected.txt` compares
      stderr) and required manifest fields (case directory, CLI args, expected
      exit, optional env, and `status` enum like `pending`/`ready`/`needs-harness`
      used by pytest selection). Add `tests/e2e/diagnostics/manifest.yaml`
      enumerating every diagnostic code from
      `docs/specs/spec_diagnostic_codes.md`.
    verify:
      - rg -n "PARSE-001" tests/e2e/diagnostics/manifest.yaml
    files:
      - tests/e2e/diagnostics/README.md
      - tests/e2e/diagnostics/manifest.yaml
    links:
      scratchpad: agents/scratchpads/T-149_diagnostics_e2e_conventions.md
  - id: T-156
    title: GraphIR verification diagnostics use instance names and spans
    owner: Executor
    dod: >
      Ensure GraphIR verification errors for duplicate endpoints report the
      instance name (not the internal inst_id) and propagate a source span
      when available. Store endpoint source locations in GraphIR ops, and have
      GraphIR verification/pipeline diagnostics surface spans for duplicate
      endpoint errors. Add unit tests that assert the diagnostic message uses
      the instance name and includes a primary span.
    verify:
      - venv/bin/pytest tests/unit_tests/ir/test_graphir_structure.py -v
    files:
      - src/asdl/ir/graphir/ops_module.py
      - src/asdl/ir/graphir/ops_graph.py
      - src/asdl/ir/converters/ast_to_graphir_lowering_nets.py
      - src/asdl/ir/pipeline.py
      - tests/unit_tests/ir/test_graphir_structure.py
    links:
      scratchpad: agents/scratchpads/T-156_graphir_verify_spans.md
  - id: T-157
    title: Update pattern specs for unified delimiters
    owner: Executor
    dod: >
      Replace numeric range syntax `[...]` with `<start:end>` in
      `docs/specs/spec_ast.md` and `docs/specs/spec_asdl_pattern_expansion.md`,
      update delimiter descriptions to remove `[]`, and add/adjust examples to
      show `<...>` for enums and ranges (including the `<digits>` enum case).
    verify:
      - rg -n "\\[[0-9]+:[0-9]+\\]" docs/specs/spec_ast.md docs/specs/spec_asdl_pattern_expansion.md
    files:
      - docs/specs/spec_ast.md
      - docs/specs/spec_asdl_pattern_expansion.md
    links:
      scratchpad: agents/scratchpads/T-157_pattern_delimiter_specs.md
  - id: T-158
    title: Update AST validation and tokenizer for `<start:end>` ranges
    owner: Executor
    dod: >
      Update AST pattern group validation to accept only `<...>` group tokens,
      update pattern tokenization to parse numeric ranges inside `<...>`, reject
      legacy `[]` ranges or mixed `|`/`:` groups, and refresh parser unit tests
      to use `<start:end>` syntax with updated expected strings.
    verify:
      - venv/bin/pytest tests/unit_tests/parser/test_pattern_atomization.py tests/unit_tests/parser/test_pattern_expansion.py tests/unit_tests/parser/test_parser.py -v
    files:
      - src/asdl/ast/models.py
      - src/asdl/ir/patterns/tokenize.py
      - tests/unit_tests/parser/test_pattern_atomization.py
      - tests/unit_tests/parser/test_pattern_expansion.py
      - tests/unit_tests/parser/test_parser.py
    links:
      scratchpad: agents/scratchpads/T-158_pattern_group_validation.md
  - id: T-159
    title: Update IR delimiter detection and tests for `<start:end>` ranges
    owner: Executor
    dod: >
      Remove `[`/`]` from pattern delimiter detection in GraphIR lowering and
      IFIR verification so pattern presence is keyed to `<`, `>`, `|`, and `;`,
      and update IR unit tests to use `<start:end>` with updated pattern_origin
      strings.
    verify:
      - venv/bin/pytest tests/unit_tests/ir/test_pattern_engine.py tests/unit_tests/ir/test_ifir_dialect.py -v
    files:
      - src/asdl/ir/converters/ast_to_graphir_lowering_instances.py
      - src/asdl/ir/ifir/dialect.py
      - tests/unit_tests/ir/test_pattern_engine.py
      - tests/unit_tests/ir/test_ifir_dialect.py
    links:
      scratchpad: agents/scratchpads/T-159_pattern_ir_tests.md
  - id: T-164
    title: Propagate pattern provenance metadata into IFIR
    owner: Executor
    dod: >
      Extend IFIR module and net/instance ops to carry structured pattern
      provenance (pattern origin + expression table), and update GraphIR->IFIR
      conversion to pass through pattern origin attributes and the pattern
      expression table. Update IFIR dialect and converter tests to assert the
      structured metadata is preserved.
    verify:
      - venv/bin/pytest tests/unit_tests/ir/test_ifir_dialect.py tests/unit_tests/ir/test_ifir_converter.py -v
    files:
      - src/asdl/ir/ifir/dialect.py
      - src/asdl/ir/converters/graphir_to_ifir.py
      - tests/unit_tests/ir/test_ifir_dialect.py
      - tests/unit_tests/ir/test_ifir_converter.py
    links:
      scratchpad: agents/scratchpads/T-164_ifir_pattern_provenance.md
  - id: T-165
    title: Document IFIR pattern provenance for emission
    owner: Executor
    dod: >
      Update IFIR and netlist emission specs to describe structured
      pattern_origin metadata, the pattern expression table, and the emitter's
      use of pattern provenance for presentation formatting.
    verify:
      - rg -n "pattern_origin" docs/specs/spec_asdl_ifir.md docs/specs/spec_netlist_emission.md
    files:
      - docs/specs/spec_asdl_ifir.md
      - docs/specs/spec_netlist_emission.md
    links:
      scratchpad: agents/scratchpads/T-165_ifir_pattern_docs.md
  - id: T-166
    title: Add backend pattern rendering config
    owner: Executor
    dod: >
      Extend backend config schema to accept an optional pattern rendering policy
      (numeric format string such as "[{N}]" or "{N}"), update loader defaults,
      and add unit tests for parsing and defaults.
    verify:
      - venv/bin/pytest tests/unit_tests/emit/test_backend_config.py -v
    files:
      - src/asdl/emit/backend_config.py
      - tests/unit_tests/emit/test_backend_config.py
    links:
      scratchpad: agents/scratchpads/T-166_backend_pattern_render_config.md
  - id: T-167
    title: Apply backend pattern rendering during netlist emission
    owner: Executor
    dod: >
      Render net/instance names using pattern provenance metadata and the backend
      pattern rendering policy, and add netlist emission tests covering bracketed
      numeric indices.
    verify:
      - venv/bin/pytest tests/unit_tests/netlist/test_netlist_emitter.py -v
    files:
      - src/asdl/emit/netlist/render.py
      - src/asdl/ir/patterns/origin.py
      - tests/unit_tests/netlist/test_netlist_emitter.py
    links:
      scratchpad: agents/scratchpads/T-167_netlist_pattern_rendering.md
backlog: []
