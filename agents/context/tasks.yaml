schema_version: 2

current_sprint: []

backlog:
  - id: T-052
    title: Backend lowering refactor
    owner: Executor
    dod: >
      Refactor backend lowering to separate verification from
      rendering/emission; reduce overly defensive checks in render paths now
      covered by verification. Focus on readability and single-pass flow
      without changing netlist output or diagnostics semantics.
    verify:
      - pytest tests/unit_tests/emit -v
      - pytest tests/unit_tests/netlist -v
    links:
      scratchpad: agents/scratchpads/T-052_backend_lowering_refactor.md
  - id: T-061
    title: AST imports schema
    owner: Executor
    dod: >
      Extend the AST schema to allow a top-level `imports: Dict[str, str]`
      mapping (namespace -> path) per `docs/specs/spec_asdl_import.md`; update
      Pydantic models, parser validation/diagnostics, and
      `scripts/generate_schema.py` output. Update `docs/specs/spec_ast.md` to
      include `imports` (keep MVP spec unchanged). Add parser/AST tests for
      valid and invalid `imports` (bad namespace, duplicate key, invalid
      type).
    verify:
      - pytest tests/unit_tests/parser -v
      - pytest tests/unit_tests/ast -v
    links:
      scratchpad: agents/scratchpads/T-061_ast_imports_schema.md
  - id: T-062
    title: Import resolution
    owner: Executor
    dod: >
      Implement import resolution + file loading per
      `docs/specs/spec_asdl_import.md` (relative/absolute/logical roots, no
      extension inference, `--lib` name ignored for resolution, path
      normalization collapses `.`/`..`, no symlink resolution). Build a
      `ProgramDB` keyed by `file_id` (absolute path) and a per-file `NameEnv`
      that allows multiple namespaces to the same file. Detect cycles with a
      readable import chain and emit diagnostics for missing files and
      malformed paths. Add unit tests for resolution order, cycles, and
      missing imports.
    verify:
      - pytest tests/unit_tests/parser -v
      - pytest tests/unit_tests/ir -v
    links:
      scratchpad: agents/scratchpads/T-062_import_resolution.md
  - id: T-063
    title: Import name resolution
    owner: Executor
    dod: >
      Wire import-aware name resolution into AST->NFIR conversion: allow
      unqualified symbols only from the current file, and `ns.symbol` for
      imported files; reject unresolved names with diagnostics. Forbid
      same-name symbol duplicates within a file regardless of kind. Emit a
      warning for unused `imports` namespaces. Add IR tests covering local
      refs, imported refs, unused-import warnings, and unresolved symbol
      diagnostics.
    verify:
      - pytest tests/unit_tests/ir -v
    links:
      scratchpad: agents/scratchpads/T-063_import_name_resolution.md
  - id: T-054
    title: Imports spec
    owner: Executor
    dod: >
      Define multi-file import/dependency spec (syntax, resolution rules,
      cycles, diagnostics). Capture proposed schema and pass boundaries in
      `docs/specs/` plus a migration note for MVP pipeline.
    verify: []
    links:
      scratchpad: agents/scratchpads/T-054_imports_spec.md
  - id: T-055
    title: Specs reconciliation
    owner: Architect
    dod: >
      Reconcile `docs/specs/` with the MVP pipeline (AST -> NFIR -> IFIR ->
      emit), deprecate CIR/NLIR or merge into IFIR in spec docs, and update
      `spec_compiler_stack.md` accordingly.
    verify: []
    links:
      scratchpad: agents/scratchpads/T-055_specs_reconciliation.md
  - id: T-056
    title: Exports sugar
    owner: Executor
    dod: >
      Add `exports` sugar to AST and lowering: allow `exports` block in modules
      and forward child ports into parent nets per `docs/specs/spec_ast.md`.
      Include diagnostics for invalid forwarding; no changes to IFIR
      semantics beyond expanded nets.
    verify:
      - pytest tests/unit_tests/ast -v
      - pytest tests/unit_tests/ir -v
    links:
      scratchpad: agents/scratchpads/T-056_exports_sugar.md

  - id: T-064
    title: Pattern endpoint equivalence
    owner: Executor
    dod: >
      Ensure NFIR verification treats word-sense-equivalent pattern tokens as the same instance (e.g., `MN_OUT<P,N>` vs `MN_OUT<P|N>`) by comparing the expansion outputs instead of raw strings. Add IR/unit tests plus the `examples/scratch/test.asdl` netlist run to prove the pipeline no longer rejects those bindings.
    verify:
      - pytest tests/unit_tests/ir -v
      - ./venv/bin/asdlc netlist examples/scratch/test.asdl
    files:
      - src/asdl/ir/nfir/dialect.py
      - src/asdl/ir/converters/nfir_to_ifir.py
      - tests/unit_tests/ir/test_ifir_converter.py
      - examples/scratch/test.asdl
    links:
      scratchpad: agents/scratchpads/T-064_pattern_equivalence.md

exploration_candidates:
  - IFIR diagnostics spans: mapping strategy, edge cases, and test fixtures.
  - CLI pipeline UX: command flow, error messaging, and file layout.
  - Netlist emission validation: strictness vs warnings; validation stages.
  - xDSL pipeline boundaries: pass split/merge opportunities and IR boundaries.
  - Codebase map gaps: navigation audit for future Executors.
