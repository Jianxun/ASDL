schema_version: 2

current_sprint:
  - id: T-090
    title: Pattern atomization helpers
    owner: Executor
    dod: >
      Add atomization helpers in `src/asdl/patterns.py` that expand a pattern
      token into single-atom pattern tokens with emitted literal names and
      origin metadata, including base-less patterns. Provide endpoint
      atomization helpers and diagnostics for malformed tokens. Add parser-level
      unit tests for atomization outputs and error cases.
    verify:
      - pytest tests/unit_tests/parser/test_pattern_atomization.py -v
    files:
      - src/asdl/patterns.py
      - tests/unit_tests/parser/test_pattern_atomization.py
    links:
      adr: agents/adr/ADR-0011-pattern-atomization-collisions.md
  - id: T-091
    title: IFIR pattern_origin metadata
    owner: Executor
    dod: >
      Add optional `pattern_origin` metadata to IFIR net/instance ops (dialect
      definitions + constructors + assembly format) and cover round-trip
      parsing/printing in `tests/unit_tests/ir/test_ifir_dialect.py`.
    verify:
      - pytest tests/unit_tests/ir/test_ifir_dialect.py -v
    files:
      - src/asdl/ir/ifir/dialect.py
      - tests/unit_tests/ir/test_ifir_dialect.py
    links:
      adr: agents/adr/ADR-0011-pattern-atomization-collisions.md
  - id: T-093
    title: PatternAtomizePass core expansion
    owner: Executor
    depends_on:
      - T-090
      - T-091
    dod: >
      Implement PatternAtomizePass to expand multi-atom net/instance pattern
      tokens into per-atom IFIR ops using the atomization helpers, carrying
      `pattern_origin` metadata for derived names. Validate literal-name
      collisions within nets and within instances with clear diagnostics, and
      handle base-less pattern forwarding. Add tests for base-less forwarding
      and collision diagnostics.
    verify:
      - pytest tests/unit_tests/ir/test_pattern_atomization.py -v
    files:
      - src/asdl/ir/pattern_atomization.py
      - tests/unit_tests/ir/test_pattern_atomization.py
    links:
      adr: agents/adr/ADR-0011-pattern-atomization-collisions.md
  - id: T-094
    title: PatternAtomizePass endpoint validation and params
    owner: Executor
    depends_on:
      - T-093
    dod: >
      Extend PatternAtomizePass to enforce that endpoint instance atoms resolve
      to declared instance atoms and to materialize per-atom instance params
      using patterned-parameter expansion rules (broadcast/zip with
      diagnostics). Add tests for subset endpoint bindings and parameter
      expansion diagnostics.
    verify:
      - pytest tests/unit_tests/ir/test_pattern_atomization.py -v
    files:
      - src/asdl/ir/pattern_atomization.py
      - tests/unit_tests/ir/test_pattern_atomization.py
    links:
      adr: agents/adr/ADR-0011-pattern-atomization-collisions.md
  - id: T-095
    title: Wire PatternAtomizePass into MVP pipeline
    owner: Executor
    depends_on:
      - T-094
    dod: >
      Run PatternAtomizePass after NFIR->IFIR in the MVP pipeline and add a
      pipeline-level test proving pattern tokens are atomized before emission.
    verify:
      - pytest tests/unit_tests/e2e/test_pipeline_mvp.py -v
    files:
      - src/asdl/ir/pipeline.py
      - tests/unit_tests/e2e/test_pipeline_mvp.py
    links:
      adr: agents/adr/ADR-0011-pattern-atomization-collisions.md
  - id: T-092
    title: Netlist emission assumes atomized IFIR
    owner: Executor
    depends_on:
      - T-095
    dod: >
      Remove pattern elaboration from netlist emission and update netlist tests
      to rely on atomized IFIR output. Replace or retire pattern elaboration
      tests as needed and add coverage to ensure emit-time does not expand
      patterns.
    verify:
      - pytest tests/unit_tests/netlist/test_netlist_emitter.py -v
    files:
      - src/asdl/emit/netlist/api.py
      - tests/unit_tests/netlist/test_netlist_emitter.py
      - tests/unit_tests/ir/test_pattern_elaboration.py
    links:
      adr: agents/adr/ADR-0011-pattern-atomization-collisions.md
  - id: T-096
    title: Expand env vars in backend templates
    owner: Executor
    dod: >
      Expand shell-style env vars (e.g., $PDK_PATH, ${PDK_PATH}) in rendered
      backend templates for both system devices and device backends, using the
      same failure rules as import path expansion (error if vars remain
      unresolved). Emit a new EMIT diagnostic on unresolved env vars and add
      netlist tests for success and failure cases.
    verify:
      - pytest tests/unit_tests/netlist/test_netlist_emitter.py -v
    files:
      - src/asdl/emit/netlist/render.py
      - src/asdl/emit/netlist/diagnostics.py
      - tests/unit_tests/netlist/test_netlist_emitter.py
    links:
      scratchpad: agents/scratchpads/T-096.md
backlog: []

exploration_candidates:
  - IFIR diagnostics spans: mapping strategy, edge cases, and test fixtures.
  - CLI pipeline UX: command flow, error messaging, and file layout.
  - Netlist emission validation: strictness vs warnings; validation stages.
  - xDSL pipeline boundaries: pass split/merge opportunities and IR boundaries.
  - Codebase map gaps: navigation audit for future Executors.
