schema_version: 2

current_sprint:
  - id: T-120
    title: Pattern subsystem package split
    owner: Executor
    dod: >
      Replace the monolithic patterns module with a `src/asdl/patterns/` package
      that separates tokenization, expansion, atomization, and diagnostics while
      preserving the public API (`expand_pattern`, `expand_endpoint`,
      `atomize_pattern`, `atomize_endpoint`) and existing behavior. Update
      imports and keep diagnostics codes unchanged.
    verify:
      - venv/bin/pytest tests/unit_tests/parser/test_pattern_expansion.py tests/unit_tests/parser/test_pattern_atomization.py -v
    files:
      - src/asdl/patterns.py
      - src/asdl/patterns/__init__.py
      - src/asdl/patterns/atomize.py
      - src/asdl/patterns/expand.py
      - src/asdl/patterns/tokenize.py
    links:
      scratchpad: agents/scratchpads/T-120_pattern_package_split.md
  - id: T-121
    title: Centralize pattern binding verification helpers
    owner: Executor
    dod: >
      Introduce shared helpers for pattern binding/length/collision checks and
      reuse them in NFIR verification and NFIR->IFIR conversion. Keep existing
      diagnostics codes and VerifyException text stable; behavior remains
      unchanged.
    verify:
      - venv/bin/pytest tests/unit_tests/ir/test_ifir_converter.py tests/unit_tests/ir/test_pattern_atomization.py -v
    files:
      - src/asdl/ir/nfir/dialect.py
      - src/asdl/ir/converters/nfir_to_ifir.py
      - src/asdl/patterns/verify.py
      - tests/unit_tests/ir/test_pattern_atomization.py
    links:
      scratchpad: agents/scratchpads/T-121_pattern_verification_helpers.md
  - id: T-122
    title: Consolidate GraphIR rebundling utilities
    owner: Executor
    dod: >
      Keep GraphIR rebundling helpers in `src/asdl/ir/graphir/patterns.py` only
      and remove wrapper exports from pattern passes. Update call sites and
      ensure tests continue to exercise rebundling behavior.
    verify:
      - venv/bin/pytest tests/unit_tests/ir/test_pattern_atomization.py -v
    files:
      - src/asdl/ir/graphir/patterns.py
      - src/asdl/ir/pattern_atomization.py
      - src/asdl/ir/pattern_elaboration.py
    links:
      scratchpad: agents/scratchpads/T-122_graphir_rebundling_cleanup.md
  - id: T-123
    title: Pattern tests and docs cleanup
    owner: Executor
    dod: >
      Reorganize pattern tests into a focused suite (parser + IR integration),
      add a short doc note describing atomized-only IFIR expectations for
      emission, and remove stale references to the deprecated elaboration pass.
    verify:
      - venv/bin/pytest tests/unit_tests/parser/test_pattern_expansion.py tests/unit_tests/parser/test_pattern_atomization.py tests/unit_tests/ir/test_pattern_atomization.py -v
    files:
      - tests/unit_tests/parser/test_pattern_expansion.py
      - tests/unit_tests/parser/test_pattern_atomization.py
      - tests/unit_tests/ir/test_pattern_atomization.py
      - docs/outstanding_topics.md
      - agents/context/contract.md
    links:
      scratchpad: agents/scratchpads/T-123_pattern_tests_docs_cleanup.md
  - id: T-112
    title: GraphIR to AST normalized output
    owner: Executor
    dod: >
      Add a GraphIR -> AST normalized serializer that emits explicit nets and
      instances without authoring sugar. Include roundtrip tests that parse,
      lower to GraphIR, and re-emit AST with deterministic ordering.
    verify:
      - venv/bin/pytest tests/unit_tests/ast -v
    files:
      - src/asdl/ir/converters/graphir_to_ast.py
      - src/asdl/ast/models.py
      - src/asdl/ast/parser.py
      - tests/unit_tests/ast/test_graphir_roundtrip.py
    links:
      scratchpad: agents/scratchpads/T-112_graphir_to_ast_normalized.md
      spec: docs/specs/spec_asdl_graphir.md
  - id: T-119
    title: Named pattern substitution in GraphIR path
    owner: Architect
    dod: >
      Decide where named pattern substitution belongs in the GraphIR pipeline
      (AST parse, AST->GraphIR conversion, or a dedicated pass), record the
      decision in contract/ADR if needed, and note migration implications.
    verify:
      - rg -n "Named pattern substitution" agents/context/contract.md agents/adr
    files:
      - agents/context/contract.md
      - agents/adr/ADR-0015-named-pattern-substitution.md
      - agents/scratchpads/T-119_named_pattern_substitution.md
    links:
      scratchpad: agents/scratchpads/T-119_named_pattern_substitution.md
  - id: T-124
    title: AST to GraphIR converter refactor plan
    owner: Architect
    dod: >
      Review `ast_to_graphir.py` structure, propose a refactor plan to split it
      into focused helpers/modules before adding new features, and record the
      decision in contract/ADR if needed with migration notes.
    verify:
      - rg -n "ast_to_graphir refactor" agents/context/contract.md agents/adr
    files:
      - src/asdl/ir/converters/ast_to_graphir.py
      - agents/context/contract.md
      - agents/adr/ADR-0016-ast-to-graphir-refactor.md
      - agents/scratchpads/T-124_ast_to_graphir_refactor.md
    links:
      scratchpad: agents/scratchpads/T-124_ast_to_graphir_refactor.md
backlog: []

exploration_candidates:
  - IFIR diagnostics spans: mapping strategy, edge cases, and test fixtures.
  - CLI pipeline UX: command flow, error messaging, and file layout.
  - Netlist emission validation: strictness vs warnings; validation stages.
  - xDSL pipeline boundaries: pass split/merge opportunities and IR boundaries.
  - Codebase map gaps: navigation audit for future Executors.
