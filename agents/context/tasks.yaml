schema_version: 2

current_sprint:
  - id: T-305
    title: Query CLI foundation and shared runtime
    owner: Executor
    dod: >
      Add the `asdlc query` command group with shared/common options and
      validation, plus a reusable query runtime module that centralizes stage
      construction (`authored`/`resolved`/`emitted`), JSON envelope emission
      (`schema_version=1` and `kind`), and shared diagnostics/exit behavior.
      Enforce the spec rule that missing anchors are hard errors while valid
      empty results remain successful. Include focused CLI regression tests for
      common option validation and JSON envelope stability.
    verify:
      - ./venv/bin/pytest tests/unit_tests/cli/test_query_cli_runtime.py -v
    links:
      scratchpad: agents/scratchpads/T-305_query_cli_foundation.md
      spec: docs/specs/spec_cli_query.md
    files:
      - src/asdl/cli/__init__.py
      - src/asdl/cli/query_runtime.py
      - tests/unit_tests/cli/test_query_cli_runtime.py
  - id: T-306
    title: Implement `asdlc query tree`
    owner: Executor
    depends_on:
      - T-305
    dod: >
      Implement `asdlc query tree` for all supported stages and output modes.
      Output entries must match the v0 JSON contract and deterministic ordering
      rules. Ensure emitted stage without explicit view profile uses baseline
      resolution semantics. Add regression coverage for shape, ordering, and
      stage-specific nullability.
    verify:
      - ./venv/bin/pytest tests/unit_tests/cli/test_query_tree.py -v
    links:
      scratchpad: agents/scratchpads/T-306_query_tree.md
      spec: docs/specs/spec_cli_query.md
    files:
      - src/asdl/cli/__init__.py
      - src/asdl/cli/query_runtime.py
      - tests/unit_tests/cli/test_query_tree.py
  - id: T-307
    title: Implement `asdlc query bindings`
    owner: Executor
    depends_on:
      - T-305
    dod: >
      Implement `asdlc query bindings` with required `--view-config` and
      `--view-profile` pairing and deterministic `(path, instance)` output
      ordering. Ensure payload rows include `authored_ref`, `resolved`, and
      `rule_id` according to the frozen v0 contract. Add regression tests for
      option validation, payload shape, and deterministic ordering.
    verify:
      - ./venv/bin/pytest tests/unit_tests/cli/test_query_bindings.py -v
    links:
      scratchpad: agents/scratchpads/T-307_query_bindings.md
      spec: docs/specs/spec_cli_query.md
    files:
      - src/asdl/cli/__init__.py
      - src/asdl/cli/query_runtime.py
      - src/asdl/views/api.py
      - tests/unit_tests/cli/test_query_bindings.py
  - id: T-308
    title: Implement `asdlc query emit-plan`
    owner: Executor
    depends_on:
      - T-305
    dod: >
      Implement `asdlc query emit-plan` with top symbol fields and deterministic
      reachable/pruned module payloads aligned to reachable-only emission and
      realized naming semantics. Ensure stage behavior and baseline emitted-mode
      defaults match the query spec. Add regression tests for mapping payload
      structure and deterministic ordering.
    verify:
      - ./venv/bin/pytest tests/unit_tests/cli/test_query_emit_plan.py -v
    links:
      scratchpad: agents/scratchpads/T-308_query_emit_plan.md
      spec: docs/specs/spec_cli_query.md
    files:
      - src/asdl/cli/__init__.py
      - src/asdl/cli/query_runtime.py
      - src/asdl/emit/netlist/render.py
      - tests/unit_tests/cli/test_query_emit_plan.py
  - id: T-309
    title: Implement `asdlc query refs`
    owner: Executor
    depends_on:
      - T-305
    dod: >
      Implement `asdlc query refs` using exact `--module` symbol match in v0
      (no wildcard/decorated-family expansion), with deterministic result
      ordering and stage-aware fields. Add regression tests covering exact-match
      behavior, empty-success behavior, and ordering.
    verify:
      - ./venv/bin/pytest tests/unit_tests/cli/test_query_refs.py -v
    links:
      scratchpad: agents/scratchpads/T-309_query_refs.md
      spec: docs/specs/spec_cli_query.md
    files:
      - src/asdl/cli/__init__.py
      - src/asdl/cli/query_runtime.py
      - tests/unit_tests/cli/test_query_refs.py
  - id: T-310
    title: Implement `asdlc query instance`
    owner: Executor
    depends_on:
      - T-305
    dod: >
      Implement `asdlc query instance --path` with anchor-not-found hard-error
      behavior and payload fields per v0 contract. Ensure `children` ordering is
      deterministic and `connected_nets` uses lexical ordering (provisional v0
      rule). Add regression tests for success, missing-anchor, and ordering.
    verify:
      - ./venv/bin/pytest tests/unit_tests/cli/test_query_instance.py -v
    links:
      scratchpad: agents/scratchpads/T-310_query_instance.md
      spec: docs/specs/spec_cli_query.md
    files:
      - src/asdl/cli/__init__.py
      - src/asdl/cli/query_runtime.py
      - tests/unit_tests/cli/test_query_instance.py
  - id: T-311
    title: Implement `asdlc query net`
    owner: Executor
    depends_on:
      - T-305
    dod: >
      Implement `asdlc query net --module --net` with user-facing `connections`
      records and `terminal` naming (not internal endpoint terminology). Enforce
      missing-anchor hard errors and deterministic `(instance_path, terminal)`
      ordering for connection rows. Add regression tests for schema shape and
      ordering.
    verify:
      - ./venv/bin/pytest tests/unit_tests/cli/test_query_net.py -v
    links:
      scratchpad: agents/scratchpads/T-311_query_net.md
      spec: docs/specs/spec_cli_query.md
    files:
      - src/asdl/cli/__init__.py
      - src/asdl/cli/query_runtime.py
      - tests/unit_tests/cli/test_query_net.py

backlog:
  - id: T-312
    title: Implement experimental `asdlc query net-trace`
    owner: Executor
    depends_on:
      - T-305
      - T-311
    dod: >
      Implement `asdlc query net-trace` in a follow-up wave with explicitly
      provisional semantics as documented in the v0 spec open decisions.
      Preserve deterministic output ordering for `equivalents` and
      `connections`, and retain user-facing `terminal` naming. Include focused
      regression coverage for direction/order switches and deterministic output.
    verify:
      - ./venv/bin/pytest tests/unit_tests/cli/test_query_net_trace.py -v
    links:
      scratchpad: agents/scratchpads/T-312_query_net_trace.md
      spec: docs/specs/spec_cli_query.md
    files:
      - src/asdl/cli/__init__.py
      - src/asdl/cli/query_runtime.py
      - tests/unit_tests/cli/test_query_net_trace.py
