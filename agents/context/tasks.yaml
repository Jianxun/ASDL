schema_version: 2

current_sprint:
  - id: T-313
    title: Add shared hierarchy traversal utility (v0)
    owner: Executor
    dod: >
      Implement shared traversal infrastructure in `src/asdl/core/hierarchy.py`
      with a single public API
      `traverse_hierarchy(design, *, include_devices, order="dfs-pre")`.
      The traversal must be deterministic DFS-pre, include centralized module
      selection by `(file_id, symbol)`, and enforce ancestry-based cycle stop
      behavior. Add dedicated unit tests for include/exclude-device policy,
      stable ordering, module-selection fallback, and cycle handling.
    verify:
      - ./venv/bin/pytest tests/unit_tests/core/test_hierarchy.py -v
    links:
      scratchpad: agents/scratchpads/T-313_shared_hierarchy_traversal.md
      spec: docs/specs/spec_hierarchy_traversal.md
      adr: agents/adr/ADR-0038-shared-hierarchy-traversal.md
    files:
      - src/asdl/core/hierarchy.py
      - src/asdl/core/__init__.py
      - tests/unit_tests/core/test_hierarchy.py
  - id: T-314
    title: Migrate views instance index to shared traversal
    owner: Executor
    depends_on:
      - T-313
    dod: >
      Refactor `asdl.views.instance_index.build_instance_index` to consume
      shared traversal with `include_devices=False` and preserve current
      module-only index behavior. Remove duplicated traversal and module
      selection helpers from views index code once migrated. Keep existing
      view-binding matching semantics/output unchanged and update regressions
      to prove no behavior drift.
    verify:
      - ./venv/bin/pytest tests/unit_tests/views/test_instance_index.py tests/unit_tests/views/test_view_resolver.py -v
    links:
      scratchpad: agents/scratchpads/T-314_views_instance_index_migration.md
      spec: docs/specs/spec_hierarchy_traversal.md
      adr: agents/adr/ADR-0038-shared-hierarchy-traversal.md
    files:
      - src/asdl/views/instance_index.py
      - src/asdl/views/resolver.py
      - tests/unit_tests/views/test_instance_index.py
      - tests/unit_tests/views/test_view_resolver.py
  - id: T-315
    title: Migrate query tree traversal to shared utility
    owner: Executor
    depends_on:
      - T-313
    dod: >
      Refactor query-tree payload construction to consume shared traversal with
      `include_devices=True`, preserving current compact/verbose JSON payloads
      and default ASCII tree text output exactly. Remove duplicate traversal
      helpers from query runtime once migrated. Retain stage-aware behavior and
      deterministic ordering with no output contract changes.
    verify:
      - ./venv/bin/pytest tests/unit_tests/cli/test_query_tree.py tests/unit_tests/cli/test_query_cli_runtime.py -v
    links:
      scratchpad: agents/scratchpads/T-315_query_tree_traversal_migration.md
      spec: docs/specs/spec_hierarchy_traversal.md
      adr: agents/adr/ADR-0038-shared-hierarchy-traversal.md
    files:
      - src/asdl/cli/query_runtime.py
      - src/asdl/cli/__init__.py
      - tests/unit_tests/cli/test_query_tree.py
      - tests/unit_tests/cli/test_query_cli_runtime.py
  - id: T-316
    title: Shared traversal convergence and guardrail tests
    owner: Executor
    depends_on:
      - T-314
      - T-315
    dod: >
      Add convergence coverage that jointly validates module-only behavior for
      views indexing and module+device behavior for query tree after shared
      traversal migration. Confirm duplicate traversal/module-selection logic is
      removed from migrated subsystems and shared utility is the sole source of
      hierarchy traversal truth.
    verify:
      - ./venv/bin/pytest tests/unit_tests/views/test_instance_index.py tests/unit_tests/cli/test_query_tree.py -v
    links:
      scratchpad: agents/scratchpads/T-316_shared_traversal_convergence.md
      spec: docs/specs/spec_hierarchy_traversal.md
      adr: agents/adr/ADR-0038-shared-hierarchy-traversal.md
    files:
      - src/asdl/core/hierarchy.py
      - src/asdl/views/instance_index.py
      - src/asdl/cli/query_runtime.py
      - tests/unit_tests/views/test_instance_index.py
      - tests/unit_tests/cli/test_query_tree.py
backlog: []
