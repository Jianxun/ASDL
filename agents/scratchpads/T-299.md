# T-299 â€” Implement deterministic ordinal collision allocator in netlist emission

## Task summary (DoD + verify)
- **DoD**: Replace hash-based cross-file disambiguation in emitted module names with a deterministic ordinal allocator (`base`, `base__2`, `base__3`, ...), preserving emission traversal order and handling decorated-vs-literal base collisions. Emit warning diagnostics on renamed collisions and expose deterministic rename mapping data for compile-log integration. Include self-contained regressions under `tests/` for duplicate bases, decorated collisions, and pre-existing suffixed names.
- **Verify**: `./venv/bin/pytest tests/unit_tests/netlist/test_netlist_render_netlist_ir.py tests/unit_tests/netlist/test_netlist_emitter.py -k "view or collision or disambiguation" -v`

## Read (paths)
- `agents/context/lessons.md`
- `agents/context/contract.md`
- `agents/context/tasks.yaml`
- `agents/context/tasks_state.yaml`
- `agents/context/project_status.md`

## Plan
- [x] Baseline current behavior with focused tests
- [x] Add/update regression tests for ordinal collision naming behavior
- [x] Implement deterministic allocator + diagnostics + mapping exposure
- [x] Re-run verification and summarize

## Milestone notes
- Intake complete and task moved to `in_progress`.
- Added failing regressions for ordinal naming and decorated/literal collisions.
- Replaced hash allocator with deterministic global ordinal allocator.
- Added `EMIT-014` warning diagnostics for renamed collisions.
- Added `build_emission_name_map()` for deterministic logical/base/emitted mapping export.

## Patch summary
- Updated netlist emission module-name allocation to use deterministic ordinal suffixes (`__2`, `__3`, ...), preserving module traversal order.
- Added collision warning diagnostic code `EMIT-014` and emitted warnings whenever a module symbol is renamed due to emitted-name collisions.
- Added public emission mapping helper (`build_emission_name_map`) returning deterministic mapping entries (`symbol`, `file_id`, `base_name`, `emitted_name`, `renamed`).
- Updated/added regression tests covering:
  - duplicate base collisions
  - decorated-vs-literal base collisions
  - pre-existing suffixed-name collisions (`__2` already present)
  - mapping export content and ordering

## PR URL
- Pending.

## Verification
- `./venv/bin/pytest tests/unit_tests/netlist/test_netlist_render_netlist_ir.py tests/unit_tests/netlist/test_netlist_emitter.py -k "view or collision or disambiguation" -v` (pass)
- `./venv/bin/pytest tests/unit_tests/netlist/test_netlist_render_netlist_ir.py tests/unit_tests/netlist/test_netlist_emitter.py -v` (pass)

## Status request (Done / Blocked / In Progress)
- In Progress

## Blockers / Questions
- None.

## Next steps
- Push branch, open PR, record PR URL/number, set task state to `ready_for_review`, and lint task state.
