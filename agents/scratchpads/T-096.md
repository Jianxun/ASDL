# T-096: Expand env vars in backend templates

## Task summary (DoD + verify)
- Expand shell-style env vars ($VAR, ${VAR}) in rendered backend templates for system devices and device backends.
- Use same failure rules as import path expansion: error if vars remain unresolved.
- Emit new EMIT diagnostic on unresolved env vars.
- Add netlist tests for success and failure cases.
- Verify: `pytest tests/unit_tests/netlist/test_netlist_emitter.py -v`

## Read
- agents/context/lessons.md
- agents/context/contract.md
- agents/context/tasks.yaml
- agents/context/tasks_state.yaml
- agents/context/project_status.md

## Plan
- Inspect netlist render and diagnostics for template handling and import path expansion.
- Implement env var expansion for templates (system devices and device templates) with error diagnostic.
- Add netlist tests for expansion success and unresolved error.
- Run verify command.

## Progress log
- Understanding: add env-var expansion to rendered system/device templates, emit EMIT-011 on unresolved vars, and cover success/failure in netlist tests.
- Todo:
  - [x] Add netlist tests for env var expansion and unresolved error.
  - [x] Implement env var expansion + diagnostics in netlist rendering/verification.
  - [x] Run netlist emitter tests.
  - Tests: `./venv/bin/pytest tests/unit_tests/netlist/test_netlist_emitter.py -v`
- Review: fixed env var placeholder restoration collision by using regex substitution.

## Patch summary
- Added env var expansion tests for backend/system templates and unresolved errors.
- Expanded env vars in netlist template rendering with EMIT-011 diagnostics on unresolved vars.
- Escaped braced env vars during template parsing/formatting to avoid placeholder conflicts.
- Use exact placeholder substitution to avoid env var restoration collisions.

## PR URL
https://github.com/Jianxun/ASDL/pull/105

## Verification
- `./venv/bin/pytest tests/unit_tests/netlist/test_netlist_emitter.py -v`

## Status request (Done / Blocked / In Progress)
Done

## Blockers / Questions

## Next steps
