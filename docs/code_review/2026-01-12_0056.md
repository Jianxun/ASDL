# ASDL Compiler Architecture Review (2026-01-12 00:56)

## Findings
- Medium: Pattern elaboration is implemented but never invoked; `run_mvp_pipeline` stops after atomization and `emit_netlist` consumes IFIR directly, so pattern tokens can leak into emission instead of being fully elaborated. Refs: `src/asdl/ir/pipeline.py:168`, `src/asdl/ir/pattern_elaboration.py:34`, `src/asdl/emit/netlist/api.py:45`.
- Low: Import resolution diagnostics lack source spans because `resolve_import_graph` passes `loc=None` for every import, so missing/ambiguous import errors are unanchored. Ref: `src/asdl/imports/resolver.py:126`.
- Low: The in-memory path `run_mvp_pipeline(document=...)` bypasses import resolution; any qualified references or `imports:` will fail as unresolved, which is a footgun for API consumers. Refs: `src/asdl/ir/pipeline.py:151`, `src/asdl/ir/converters/ast_to_nfir.py:178`.

## Open Questions
- Should pattern elaboration be a required stage before netlist emission (pipeline vs. emitter), or is atomized-but-unelaborated IFIR the intended output for now?
- Should the `document` path accept a pre-built `ImportGraph`/`NameEnv`, or should the API be explicit that imports only work with `entry_file`?
- Are unspanned import diagnostics acceptable, or should we thread import path locations from the parser into the resolver?

## Pipeline Flow (Current)
- CLI netlist command: `asdlc netlist` -> `run_mvp_pipeline` -> `load_backend` -> `emit_netlist` -> write output. Refs: `src/asdl/cli/__init__.py:106`, `src/asdl/emit/netlist/api.py:45`.
- Pipeline core: parse/import-resolve -> AST->NFIR -> optional NFIR verify -> NFIR->IFIR -> pattern atomize -> optional IFIR verify. Ref: `src/asdl/ir/pipeline.py:141`.
- Emission: netlist verification pass -> render via backend templates. Ref: `src/asdl/emit/netlist/api.py:64`.
